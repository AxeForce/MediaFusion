<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Configuration - Stremio Addon</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.css" rel="stylesheet"/>
    <link href="/static/css/styles.css" rel="stylesheet">

</head>

<body>
<div class="container">
    <div class="row">
        <div class="col-10 col-md-11 col-lg-11 config-container">
            <a href="/"><img class="logo" src="{{ logo_url }}"></a>
            <h3 class="text-center mb-4">{{ addon_name }} Addon Configuration</h3>

            <!-- Configuration Form -->
            <form id="configForm" class="mx-5 mx-lg-1 mx-md-3 mx-sm-4">

                <!-- Configuration Mode Switch -->
                <div class="section-container">
                    <h4 class="section-header">Configuration Mode</h4>
                    <hr class="section-divider">

                    <div class="mode-switch">
                        <div class="mode-buttons">
                            <button type="button" class="mode-btn active" id="newbie_mode" onclick="setConfigMode('newbie')">
                                <i class="bi bi-person-heart"></i>
                                Newbie User
                            </button>
                            <button type="button" class="mode-btn" id="pro_mode" onclick="setConfigMode('pro')">
                                <i class="bi bi-person-gear"></i>
                                Pro User
                            </button>
                        </div>
                        <p class="mode-description">
                            Newbie Mode: Quick setup with essential options for new users
                        </p>
                    </div>
                </div>

                <!-- Removed Streaming Provider Section -->

                <!-- Catalog Configuration -->
                <div class="section-container pro-mode-section" style="display: none;">
                    <h4 class="section-header">Catalog Configuration</h4>
                    <hr class="section-divider">

                    <div class="mb-3">
                        <h6>Select & Arrange Catalogs: <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                             title="Select and arrange the catalogs that you want to display in Stremio."></span></h6>
                        <div id="catalogs" class="row">
                            {% for catalog in catalogs %}
                                <div class="col-12 col-md-6 col-lg-4 draggable-catalog" data-id="{{ catalog[0] }}">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="selected_catalogs" value="{{ catalog[0] }}" id="{{ catalog[0] }}" {% if catalog[0] in
                                           user_data.selected_catalogs %}checked{% endif %}>
                                        <label class="form-check-label" for="{{ catalog[0] }}">
                                            <span class="label-text">{{ catalog[1] }}</span>
                                        </label>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Enable Catalogs Checkbox -->
                    <div class="mb-3">
                        <h6>Enable Catalogs:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="enable_catalogs"
                                   id="enable_catalogs" {% if user_data.enable_catalogs %}checked{% endif %}>
                            <label class="form-check-label" for="enable_catalogs">
                                Show Catalogs in Stremio & Kodi <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                                      title="Toggle to add or hide catalogs in Stremio. This is perfect for when you want to install multiple addons without creating duplicate catalog content and only want to display streams."></span>
                            </label>
                        </div>
                    </div>
                    <!-- Enable MetaData Response Checkbox -->
                    <div class="mb-3">
                        <h6>Enable IMDb Title Meta Data Response:</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="enable_imdb_metadata"
                                   id="enable_imdb_metadata" {% if user_data.enable_imdb_metadata %}checked{% endif %}>
                            <label class="form-check-label" for="enable_imdb_metadata">
                                Enable IMDb Meta Data Response
                                <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                      title="Toggle to enable or disable IMDb title metadata response.
                                      Stremio user prefer to only use cinemeta Addon for metadata and disable this. For the Kodi users, this option need to be enabled."></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Parental Guides Configuration -->
                <div class="section-container pro-mode-section" style="display: none;">
                    <h4 class="section-header">Parental Guides</h4>
                    <hr class="section-divider">

                    <div class="mb-3">
                        <h6>Select Certification Levels To Not Display: <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                                              title="Select the certification levels that you prefer not to display in Stremio."></span></h6>
                        <div class="row">
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Disable" id="certification_disable"
                                           {% if "Disable" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_disable">Disable</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Unknown" id="certification_unknown"
                                           {% if "Unknown" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_unknown">Unknown</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="All Ages" id="certification_all_ages"
                                           {% if "All Ages" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_all_ages">All Ages</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Children" id="certification_children"
                                           {% if "Children" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_children">Children</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Parental Guidance" id="certification_pg"
                                           {% if "Parental Guidance" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_pg">Parental Guidance</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Teens" id="certification_teens"
                                           {% if "Teens" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_teens">Teens</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Adults" id="certification_adults"
                                           {% if "Adults" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_adults">Adults</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="certification_filter" value="Adults+" id="certification_adults+"
                                           {% if "Adults+" in user_data.certification_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="certification_adults+">Adults+</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <h6>Select Nudity Filter Levels To Not Display: <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                                              title="Select the nudity filter levels that you prefer not to display in Stremio."></span></h6>
                        <div class="row">
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="Disable" id="nudity_disable"
                                           {% if "Disable" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_disable">Disable</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="Unknown" id="nudity_unknown"
                                           {% if "Unknown" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_unknown">Unknown</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="None" id="nudity_none"
                                           {% if "None" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_none">None</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="Mild" id="nudity_mild"
                                           {% if "Mild" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_mild">Mild</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="Moderate" id="nudity_moderate"
                                           {% if "Moderate" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_moderate">Moderate</label>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 col-lg-4">
                                <div class="form-check">
                                    <input class="form-check-input parental-guide-checkbox" type="checkbox" name="nudity_filter" value="Severe" id="nudity_severe"
                                           {% if "Severe" in user_data.nudity_filter %}checked{% endif %}>
                                    <label class="form-check-label" for="nudity_severe">Severe</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Removed Streaming Preferences Section -->

                <div class="section-container pro-mode-section" style="display: none;">
                    <h4 class="section-header">External Services Configuration</h4>
                    <hr>

                    <div class="mb-3">
                        <h6>MediaFlow Configuration</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="enable_mediaflow" name="enable_mediaflow"
                                   {% if user_data.mediaflow_config %}checked{% endif %}>
                            <label class="form-check-label" for="enable_mediaflow">
                                Enable MediaFlow
                                <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                   title="Enable to use MediaFlow for handling various stream types and routing."></i>
                            </label>
                        </div>
                        <div id="mediaflow_config" style="display: {% if user_data.mediaflow_config %}block{% else %}none{% endif %}">
                            <div class="mb-2">
                                <a href="https://github.com/mhdzumair/mediaflow-proxy?tab=readme-ov-file#mediaflow-proxy" target="_blank" rel="noopener">
                                    MediaFlow Setup Guide
                                </a>
                            </div>
                            <div class="mb-2">
                                <label for="mediaflow_proxy_url">MediaFlow Proxy URL:</label>
                                <input type="text" class="form-control" id="mediaflow_proxy_url" name="mediaflow_proxy_url"
                                       placeholder="https://your-mediaflow-proxy-url.com or http://127.0.0.1:8888"
                                       value="{{ user_data.mediaflow_config.proxy_url if user_data.mediaflow_config else '' }}">
                                <div class="invalid-feedback">
                                    Please enter a valid MediaFlow Proxy URL.
                                </div>
                            </div>
                            <div class="mb-2">
                                <label for="mediaflow_api_password">MediaFlow API Password:</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="mediaflow_api_password" name="mediaflow_api_password"
                                           value="{{ user_data.mediaflow_config.api_password if user_data.mediaflow_config else '' }}">
                                    <button class="btn btn-outline-secondary" type="button" id="toggleMediaFlowPassword">
                                        <i id="toggleMediaFlowPasswordIcon" class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Please enter the MediaFlow API password.
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="mediaflow_public_ip">MediaFlow Public IP (Optional):</label>
                                <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                   title="Configure this only when running MediaFlow locally with a proxy service. Leave empty if MediaFlow is configured locally without a proxy server or if it's hosted on
                                    a remote server."></i>
                                <input type="text" class="form-control" id="mediaflow_public_ip" placeholder="Enter public IP address. (Optional, See tooltip for details)"
                                       value="{{ user_data.mediaflow_config.public_ip if user_data.mediaflow_config else '' }}">
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="proxy_live_streams" name="proxy_live_streams"
                                       {% if user_data.mediaflow_config and user_data.mediaflow_config.proxy_live_streams %}checked{% endif %}>
                                <label class="form-check-label" for="proxy_live_streams">
                                    Proxy Live Streams
                                    <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                       title="Enable to proxy live streams through MediaFlow."></i>
                                </label>
                            </div>
                            <!-- Removed Proxy Debrid Streams option -->
                        </div>
                    </div>

                    <div class="mb-3">
                        <h6>RPDB (RatingPosterDB) Configuration</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="enable_rpdb" name="enable_rpdb"
                                   {% if user_data.rpdb_config %}checked{% endif %}>
                            <label class="form-check-label" for="enable_rpdb">
                                Enable RPDB Posters
                                <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                   title="Enable to use RPDB for rating posters. Poster configurations can be managed in your RPDB account settings."></i>
                            </label>
                        </div>
                        <div id="rpdb_config" style="display: {% if user_data.rpdb_config %}block{% else %}none{% endif %}">
                            <div class="mb-2">
                                <a href="https://ratingposterdb.com/api-key/" target="_blank" rel="noopener">Get RPDB API Key</a>
                                <span class="mx-2">|</span>
                                <a href="https://manager.ratingposterdb.com" target="_blank" rel="noopener">Configure RPDB Posters Settings</a>
                            </div>
                            <p class="text-secondary">
                                <small>RPDB is an optional <b>Freemium</b> third-party service for enhanced rating posters. By default, MediaFusion generates rating posters using IMDb ratings.</small>
                            </p>
                            <div class="mb-2">
                                <label for="rpdb_api_key">RPDB API Key:</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="rpdb_api_key" name="rpdb_api_key"
                                           value="{{ user_data.rpdb_config.api_key if user_data.rpdb_config else '' }}">
                                    <button class="btn btn-outline-secondary" type="button" id="toggleRPDBApiKey">
                                        <i id="toggleRPDBApiKeyIcon" class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Please enter a valid RPDB API Key.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <h6>MDBList Configuration</h6>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="enable_mdblist" name="enable_mdblist"
                                   {% if user_data.mdblist_config %}checked{% endif %}>
                            <label class="form-check-label" for="enable_mdblist">
                                Enable MDBList Integration
                                <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                   title="Enable to use MDBList for custom movie and TV show lists."></i>
                            </label>
                        </div>
                        <div id="mdblist_config" style="display: {% if user_data.mdblist_config %}block{% else %}none{% endif %}">
                            <!-- API Key Configuration -->
                            <div class="mb-3">
                                <label for="mdblist_api_key">MDBList API Key:</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="mdblist_api_key" name="mdblist_api_key"
                                           value="{{ user_data.mdblist_config.api_key if user_data.mdblist_config else '' }}"
                                           placeholder="Enter your MDBList API key">
                                    <button class="btn btn-outline-secondary" type="button" id="toggleMDBListApiKey">
                                        <i id="toggleMDBListApiKeyIcon" class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-primary" type="button" id="verifyMDBListApiKey">
                                        <i class="bi bi-check-circle"></i> Verify
                                    </button>
                                </div>
                                <div class="invalid-feedback">
                                    Please enter a valid MDBList API Key.
                                </div>
                                <small class="form-text text-secondary">
                                    To get your API key:
                                    <ol>
                                        <li>Sign up/Login to <a href="https://mdblist.com" target="_blank">MDBList</a></li>
                                        <li>Go to <a href="https://mdblist.com/preferences/" target="_blank">API Key Preferences</a></li>
                                        <li>Create a new API key if you don't have one</li>
                                    </ol>
                                </small>
                            </div>

                            <!-- List Management Section -->
                            <div id="mdblist_management" style="display: none">
                                <!-- Tabs for different list sources -->
                                <ul class="nav nav-tabs mb-3" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="my-lists-tab" data-bs-toggle="tab" data-bs-target="#my-lists" type="button" role="tab">
                                            <i class="bi bi-person"></i> My Lists
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="top-lists-tab" data-bs-toggle="tab" data-bs-target="#top-lists" type="button" role="tab">
                                            <i class="bi bi-trophy"></i> Top Lists
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="search-lists-tab" data-bs-toggle="tab" data-bs-target="#search-lists" type="button" role="tab">
                                            <i class="bi bi-search"></i> Search Lists
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="add-list-tab" data-bs-toggle="tab" data-bs-target="#add-list" type="button" role="tab">
                                            <i class="bi bi-plus-circle"></i> Add List
                                        </button>
                                    </li>
                                </ul>

                                <!-- Tab Content -->
                                <div class="tab-content">
                                    <!-- My Lists -->
                                    <div class="tab-pane fade show active" id="my-lists" role="tabpanel">
                                        <div class="my-lists-container">
                                            <div class="text-center" id="my-lists-loading">
                                                <div class="spinner-border" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </div>
                                            <div id="my-lists-content"></div>
                                        </div>
                                    </div>

                                    <!-- Top Lists -->
                                    <div class="tab-pane fade" id="top-lists" role="tabpanel">
                                        <div class="top-lists-container">
                                            <div class="text-center" id="top-lists-loading">
                                                <div class="spinner-border" role="status">
                                                    <span class="visually-hidden">Loading...</span>
                                                </div>
                                            </div>
                                            <div id="top-lists-content"></div>
                                        </div>
                                    </div>

                                    <!-- Search Lists -->
                                    <div class="tab-pane fade" id="search-lists" role="tabpanel">
                                        <div class="input-group mb-3">
                                            <input type="text" class="form-control" id="list-search-input" placeholder="Search for lists...">
                                            <button class="btn btn-outline-primary" type="button" id="search-lists-btn">
                                                <i class="bi bi-search"></i> Search
                                            </button>
                                        </div>
                                        <div id="search-lists-content"></div>
                                    </div>

                                    <!-- Add List Manually -->
                                    <div class="tab-pane fade" id="add-list" role="tabpanel">
                                        <div class="mb-3">
                                            <label for="list-url-input" class="form-label">MDBList URL or ID</label>
                                            <input type="text" class="form-control" id="list-url-input"
                                                   placeholder="https://mdblist.com/lists/username/list-name or list-id">
                                        </div>
                                        <button type="button" class="btn btn-primary" id="add-list-btn">
                                            <i class="bi bi-plus-circle"></i> Add List
                                        </button>
                                    </div>
                                </div>

                                <!-- Selected Lists -->
                                <div class="mt-4">
                                    <h6>Selected Lists:</h6>
                                    <div id="selected-lists" class="list-group">
                                        <!-- Selected lists will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                {% if authentication_required %}
                    <!-- API Password Configuration -->
                    <div class="section-container">
                        <h4 class="section-header">API Security Configuration</h4>
                        <hr class="section-divider">

                        <!-- API Password Input -->
                        <div class="mb-3">
                            <label for="api_password">API Password: <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                                          title="Enter the API password you configured in the environment variables."></span></label>
                            <div class="input-group">
                                <input class="form-control" type="password" id="api_password" name="api_password" placeholder="Enter API Password">
                                <button class="btn btn-outline-secondary" type="button" id="toggleApiPassword">
                                    <span id="toggleApiPasswordIcon" class="bi bi-eye"></span>
                                </button>
                                <div class="invalid-feedback">
                                    API Password is required.
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}


                <!-- Fallback URL Display - Initially hidden -->
                <div id="fallbackUrlContainer" class="fallback-url-container" style="display: none;">
                    <label for="fallbackUrl">Installation URL <span class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                                                                    title="This is the URL that you can use to install the addon in Stremio."></span></label>
                    <textarea id="fallbackUrl" class="form-control" readonly></textarea>
                    <p>Please manually copy the URL above and paste it in the Stremio search bar. Do not share this URL with unknown persons.</p>
                </div>


                <!-- Submit and Share Buttons -->
                <div class="button-container">
                    <button type="submit" class="btn btn-primary btn-block custom-btn">Install in Stremio</button>
                    <button type="button" id="shareBtn" style="display: none;" class="btn btn-primary btn-block custom-btn">Share Manifest URL</button>
                    <button type="button" id="copyBtn" style="display: none;" class="btn btn-primary btn-block custom-btn">Copy Manifest URL</button>
                    <button type="button" id="kodiSetupBtn" class="btn btn-primary btn-block custom-btn">Setup Kodi Addon</button>
                </div>

                <!-- Kodi Code Input Modal -->
                <div class="modal fade" id="kodiCodeModal" tabindex="-1" aria-labelledby="kodiCodeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title text-primary-emphasis" id="kodiCodeModalLabel">Enter Kodi Setup Code</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-2">
                                    <a href="https://github.com/mhdzumair/MediaFusion?tab=readme-ov-file#kodi-add-on-installation" target="_blank" rel="noopener">
                                        Kodi Addon Setup Guide
                                    </a>
                                </div>
                                <input type="text" id="kodiCodeInput" class="form-control" placeholder="Enter 6-digit code" maxlength="6" value="{{ kodi_code or '' }}">
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="submitKodiCode">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>
<div id="loadingWidget" class="loading-overlay" style="display: none;">
    <div class="loading-content">
        <div class="spinner-border" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
        <h5>Please Wait</h5>
        <p id="loadingMessage">Processing your configuration...</p>
    </div>
</div>


<!-- List Item Template -->
<template id="list-item-template">
    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
        <div class="me-auto">
            <h6 class="mb-1 list-title"></h6>
            <div class="text-secondary list-details">
                <span class="item-count"></span>
                <span class="like-count badge bg-success"></span>
                <span class="media-type badge bg-primary"></span>
                <span class="list-owner badge bg-info"></span>
            </div>
        </div>
        <div class="btn-group">
            <a href="#" class="btn btn-sm btn-outline-primary list-link" target="_blank">
                <i class="bi bi-eye"></i>
            </a>
            <button type="button" class="btn btn-sm btn-outline-primary add-list-btn">
                <i class="bi bi-plus-circle"></i> Add
            </button>
        </div>
    </div>
</template>

<!-- Selected List Item Template -->
<template id="selected-list-item-template">
    <div class="list-group-item d-flex justify-content-between align-items-center">
        <div class="me-auto">
            <h6 class="mb-1 list-title"></h6>
            <div class="text-secondary">
                <span class="media-type badge bg-primary"></span>
                <span class="use-filters badge bg-secondary"></span>
                <span class="sort-info badge bg-info"></span>
            </div>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-sm btn-outline-primary edit-btn">
                <i class="bi bi-pencil"></i>
            </button>
            <button type="button" class="btn btn-sm btn-outline-danger remove-btn">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    </div>
</template>

<!-- Edit List Modal -->
<div class="modal fade" id="editListModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit List</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-list-id">
                <input type="hidden" id="edit-list-original-id">
                <div class="mb-3">
                    <label for="edit-list-title" class="form-label">List Title</label>
                    <input type="text" class="form-control" id="edit-list-title">
                </div>
                <div class="mb-3">
                    <label class="form-label">Media Type</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="edit-list-type" id="edit-list-type-movie" value="movie">
                        <label class="form-check-label" for="edit-list-type-movie">Movies</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="edit-list-type" id="edit-list-type-show" value="series">
                        <label class="form-check-label" for="edit-list-type-show">Series</label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Sorting Options</label>
                    <div class="row">
                        <div class="col-8">
                            <select class="form-select" id="edit-list-sort">
                                <option value="rank">Rank (Default)</option>
                                <option value="score">Score</option>
                                <option value="usort">User Sort</option>
                                <option value="score_average">Score Average</option>
                                <option value="released">Release Date</option>
                                <option value="releasedigital">Digital Release Date</option>
                                <option value="imdbrating">IMDb Rating</option>
                                <option value="imdbvotes">IMDb Votes</option>
                                <option value="last_air_date">Last Air Date</option>
                                <option value="imdbpopular">IMDb Popular</option>
                                <option value="tmdbpopular">TMDB Popular</option>
                                <option value="rogerebert">Roger Ebert Rating</option>
                                <option value="rtomatoes">Rotten Tomatoes</option>
                                <option value="rtaudience">RT Audience Score</option>
                                <option value="metacritic">Metacritic</option>
                                <option value="myanimelist">MyAnimeList</option>
                                <option value="letterrating">Letterboxd Rating</option>
                                <option value="lettervotes">Letterboxd Votes</option>
                                <option value="budget">Budget</option>
                                <option value="revenue">Revenue</option>
                                <option value="runtime">Runtime</option>
                                <option value="title">Title</option>
                                <option value="added">Date Added</option>
                                <option value="random">Random</option>
                            </select>
                        </div>
                        <div class="col-4">
                            <select class="form-select" id="edit-list-order">
                                <option value="desc">Descending</option>
                                <option value="asc">Ascending</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label">Catalog Filtering</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="edit-list-use-filters">
                        <label class="form-check-label" for="edit-list-use-filters">
                            Apply MediaFusion Filters
                            <i class="bi bi-question-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                               title="When enabled, this list will only show items that match your configured filters (nudity, certification, etc.) and have available streams."></i>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-list-edit">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="configured_fields" value='{{ configured_fields|tojson|safe }}'>
<input type="hidden" id="existing_config" value="{{ secret_str if secret_str else '' }}">
<input type="hidden" id="mdblist_configured_lists" value='{{ mdblist_configured_lists|tojson|safe }}'>

<!-- JS for Bootstrap and form validation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.4/toastr.min.js"></script>
<script src="/static/js/mdblist.js"></script>
<script src="/static/js/config_script.js"></script>
</body>

</html>
